<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>QPoint Web Menu - Dynamic Structure</title>
    <!-- Font Awesome 6 Free CDN -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
        integrity="sha512-DTOQO9RWCH3ppGqcWaEA1BIZOC6xxalwEsw9c2QQeAIftl+Vegovlnee1c9QX4TctnWMn13TZye+giMm8e2LwA=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Arial, sans-serif;
            background: #0a0a0a;
            color: #eee;
            height: 100vh;
            overflow: hidden;
            touch-action: manipulation;
        }

        #menu-container {
            width: 460px;
            height: 100vh;
            background: linear-gradient(to bottom, #111, #000);
            overflow-y: auto;
            padding: 15px;
            box-sizing: border-box;
            border-right: 4px solid #c00;
        }

        .path-bar {
            background: linear-gradient(to right, #1e1e1e, #0f0f0f);
            padding: 12px 15px;
            border-radius: 10px;
            margin-bottom: 20px;
            font-size: 15px;
            color: #ccc;
            display: none;
            border-left: 4px solid #c00;
            box-shadow: inset 0 0 10px rgba(200, 0, 0, 0.3);
        }

        .path-bar span {
            color: #ff4444;
            font-weight: bold;
        }

        .path-bar .node {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: #c00;
            border-radius: 50%;
            margin: 0 8px;
            vertical-align: middle;
        }

        .back-button {
            display: flex;
            align-items: center;
            padding: 14px 16px;
            background: linear-gradient(to right, #c00, #900);
            color: #fff;
            font-size: 18px;
            font-weight: bold;
            border-radius: 10px;
            margin-bottom: 20px;
            cursor: pointer;
            user-select: none;
            transition: transform 0.15s, box-shadow 0.15s;
        }

        .back-button:active {
            transform: scale(0.97);
            box-shadow: 0 0 20px rgba(200, 0, 0, 0.7);
        }

        .back-button i {
            margin-right: 14px;
            font-size: 20px;
        }

        .item {
            display: flex;
            align-items: center;
            padding: 14px 14px;
            background: #1e1e1e;
            margin: 10px 0;
            border-radius: 12px;
            border-left: 5px solid #c00;
            transition: transform 0.12s, box-shadow 0.12s;
            cursor: pointer;
        }

        .item:active {
            transform: scale(0.97);
            box-shadow: 0 0 18px rgba(200, 0, 0, 0.5);
        }

        .item.disabled {
            opacity: 0.55;
            border-left-color: #555;
            cursor: not-allowed;
        }

        .item.favorite-item {
            border-left: 5px solid #ffd700;
            background: rgba(255, 215, 0, 0.08);
        }

        .item-icon-container {
            width: 48px;
            height: 48px;
            margin-right: 16px;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }

        .item-icon {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 10px;
            background: rgba(255, 255, 255, 0.07);
            padding: 6px;
            transition: opacity 0.2s;
        }

        .item-icon.generic {
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 26px;
            color: #666;
        }

        .item-content {
            flex: 1;
            min-width: 0;
        }

        .item-title {
            font-size: 17px;
            color: #fff;
            font-weight: 600;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 220px;
        }

        .item-subtext {
            font-size: 13px;
            color: #bbb;
            margin-top: 3px;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            max-width: 220px;
        }

        .checklist-icon {
            color: #32cd32;
            margin-right: 8px;
            font-size: 20px;
        }

        .favorite-star {
            color: #ffd700;
            margin-left: 10px;
            font-size: 22px;
        }

        .item-button {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-weight: bold;
            font-size: 14px;
            cursor: pointer;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.5);
            transition: transform 0.12s;
            white-space: nowrap;
            max-width: 130px;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .item-button:active {
            transform: scale(0.96);
        }

        .btn-robot {
            background: linear-gradient(to bottom, #c00, #900);
            color: #fff;
        }

        .btn-action {
            background: linear-gradient(to bottom, #ffc107, #e0a800);
            color: #000;
        }

        .btn-device {
            background: linear-gradient(to bottom, #32cd32, #228b22);
            color: #fff;
        }

        .btn-nav {
            background: linear-gradient(to bottom, #1e90ff, #104e8b);
            color: #fff;
        }

        .level {
            transition: opacity 0.35s ease, transform 0.35s ease;
        }

        .level.hidden {
            opacity: 0;
            transform: translateX(-25px);
            pointer-events: none;
            height: 0;
            overflow: hidden;
        }
    </style>
</head>

<body>
    <div id="menu-container">
        <div id="path-bar"></div>

        <div id="levels-container"></div>
    </div>

    <script>
        let navStack = [];

        // Specific, colorful Font Awesome icons for root categories (context-based)
        const ROOT_ICONS = {
            favorites: '<i class="fas fa-star" style="color:#ffd700;"></i>',                    // Gold star
            prepare: '<i class="fas fa-check-double" style="color:#4caf50;"></i>',             // Green checklist
            robots: '<i class="fas fa-robot" style="color:#f44336;"></i>',                     // Red robot
            grippers_tools: '<i class="fas fa-hand-holding-usd" style="color:#4caf50;"></i>',  // Green hand/tool
            material_handling: '<i class="fas fa-boxes-stacked" style="color:#2196f3;"></i>',   // Blue boxes
            vision_positioning: '<i class="fas fa-eye" style="color:#9c27b0;"></i>',            // Purple eye
            safety_io: '<i class="fas fa-shield-halved" style="color:#ff5722;"></i>',           // Orange-red shield
            cell_control: '<i class="fas fa-microchip" style="color:#3f51b5;"></i>'             // Indigo chip/control
        };

        const GENERIC_ICON_SVG = `
            <svg viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                <circle cx="50" cy="50" r="45" fill="#333" />
                <text x="50" y="60" font-size="50" text-anchor="middle" fill="#666">?</text>
            </svg>
        `;

        // Default icons per action type (used when no custom icon)
        const ACTION_TYPE_ICONS = {
            robot_motion: '<i class="fas fa-robot" style="color:#f44336;"></i>',
            device_control: '<i class="fas fa-wrench" style="color:#4caf50;"></i>',
            vision: '<i class="fas fa-eye" style="color:#9c27b0;"></i>',
            system: '<i class="fas fa-cog" style="color:#2196f3;"></i>',
            action: '<i class="fas fa-bolt" style="color:#ff9800;"></i>'
        };

        // Sample JSON (Favorites at top, root categories use specific FA icons)
        const sampleJson = {
            menuVersion: "1.3",
            lastUpdated: "2026-01-30T14:45:00Z",
            root: [
                {
                    id: "favorites",
                    type: "heading",
                    headingText: "Favorites",
                    subText: "Quick Access",
                    enabled: true,
                    isFavoriteSection: true,
                    children: [
                        {
                            id: "grip_near_fav",
                            type: "action",
                            buttonText: "Near Gripper",
                            fullPath: "<RoboApps>\\RoboApp_ModbusVacTool.vi",
                            actionType: "device_control",
                            enabled: true,
                            statusText: "Released",
                            icon: "GC-CupTool.jpg",
                            favorite: true
                        },
                        {
                            id: "r1_near_fav",
                            type: "action",
                            buttonText: "R1 Near",
                            fullPath: "<RoboApps>\\RoboApp_6AxisRobot.vi",
                            actionType: "robot_motion",
                            enabled: true,
                            statusText: "Ready",
                            icon: "GLG_Robot.jpg",
                            favorite: true
                        }
                    ]
                },
                {
                    id: "prepare",
                    type: "heading",
                    headingText: "Prepare for Operation",
                    subText: "Startup & Safety Checklist",
                    enabled: true,
                    children: [
                        {
                            id: "r1_near",
                            type: "action",
                            buttonText: "R1 Near",
                            fullPath: "<RoboApps>\\RoboApp_6AxisRobot.vi",
                            actionType: "robot_motion",
                            enabled: true,
                            statusText: "Ready",
                            icon: "GLG_Robot.jpg"
                        },
                        {
                            id: "r2_far",
                            type: "action",
                            buttonText: "R2 Far",
                            fullPath: "<RoboApps>\\RoboApp_Additional6AxisRobot.vi",
                            actionType: "robot_motion",
                            enabled: false,
                            statusText: "SafeNot Found",
                            icon: "GLG_Robot.jpg"
                        }
                    ]
                },
                {
                    id: "robots",
                    type: "heading",
                    headingText: "Robots",
                    subText: "Motion Control",
                    enabled: true,
                    children: [
                        {
                            id: "near_robot",
                            type: "heading",
                            headingText: "Near Robot",
                            subText: "6-Axis",
                            enabled: true,
                            children: [
                                {
                                    id: "move_pathend",
                                    type: "action",
                                    buttonText: "Move To PATHEND",
                                    fullPath: "<RoboApps>\\RoboApp_6AxisRobot.vi",
                                    actionType: "robot_motion",
                                    enabled: true,
                                    statusText: "Ready"
                                }
                            ]
                        }
                    ]
                },
                {
                    id: "grippers_tools",
                    type: "heading",
                    headingText: "Grippers & Tools",
                    subText: "Vacuum & Generic",
                    enabled: true,
                    children: [
                        {
                            id: "near_gripper",
                            type: "action",
                            buttonText: "Near Gripper",
                            fullPath: "<RoboApps>\\RoboApp_ModbusVacTool.vi",
                            actionType: "device_control",
                            enabled: true,
                            statusText: "Released",
                            icon: "GC-CupTool.jpg"
                        }
                    ]
                },
                {
                    id: "material_handling",
                    type: "heading",
                    headingText: "Material Handling",
                    subText: "Conveyor & Rack",
                    enabled: true,
                    children: [
                        {
                            id: "conveyor",
                            type: "action",
                            buttonText: "Conveyor",
                            fullPath: "<RoboApps>\\RoboApp_ConveyorPickZone.vi",
                            actionType: "device_control",
                            enabled: true,
                            statusText: "15 Cprs",
                            icon: "GLG_Conveyor.JPG"
                        }
                    ]
                },
                {
                    id: "vision_positioning",
                    type: "heading",
                    headingText: "Vision & Positioning",
                    subText: "Camera & Alignment",
                    enabled: true,
                    children: [
                        {
                            id: "glass_position",
                            type: "action",
                            buttonText: "Glass Position",
                            fullPath: "<RoboApps>\\RoboApp_GlassPositionCamera.vi",
                            actionType: "vision",
                            enabled: true,
                            statusText: "0000 n/a",
                            icon: "GC-Camera.jpg"
                        }
                    ]
                },
                {
                    id: "safety_io",
                    type: "heading",
                    headingText: "Safety & IO",
                    subText: "E-Stop & Communication",
                    enabled: true,
                    children: [
                        {
                            id: "safety_main",
                            type: "action",
                            buttonText: "Safety",
                            fullPath: "<RoboApps>\\NODE_Safety_LIP-Enet.vi",
                            actionType: "system",
                            enabled: true,
                            statusText: "15 Cprs",
                            icon: "EStop.jpg"
                        }
                    ]
                },
                {
                    id: "cell_control",
                    type: "heading",
                    headingText: "Cell Control",
                    subText: "Automation Flow",
                    enabled: true,
                    children: [
                        {
                            id: "cell_main",
                            type: "action",
                            buttonText: "Cell Control",
                            fullPath: "<RoboApps>\\NODE_AutomationFlowManager.vi",
                            actionType: "system",
                            enabled: true,
                            statusText: "5 Cprs",
                            icon: "qpoint.jpg"
                        }
                    ]
                }
            ]
        };

        function loadMenu(json) {
            const container = document.getElementById('levels-container');
            container.innerHTML = '';

            const rootLevel = createLevel('root', json.root || json, null);
            container.appendChild(rootLevel);
            navStack = ['root'];
            showLevel('root');
        }

        function createLevel(levelId, items, parentId) {
            const div = document.createElement('div');
            div.id = `level-${levelId}`;
            div.className = 'level hidden';

            if (parentId) {
                const parentName = parentId === 'root' ? 'Main Menu' : parentId.split('-').pop().replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
                const back = document.createElement('div');
                back.className = 'back-button';
                back.innerHTML = `<i class="fas fa-arrow-left"></i> Back to ${parentName}`;
                back.onclick = () => goBack();
                div.appendChild(back);
            }

            items.forEach(item => {
                div.appendChild(createItem(item, levelId));
            });

            return div;
        }

        function createItem(item, currentLevel) {
            const div = document.createElement('div');
            div.className = 'item';
            if (item.favorite) div.classList.add('favorite-item');
            div.dataset.id = item.id;

            if (!item.enabled) div.classList.add('disabled');

            // Icon handling
            let iconHtml = '';
            if (item.type === 'heading' && !item.icon) {
                // Root category: use specific colorful Font Awesome icon
                const faIcon = ROOT_ICONS[item.id] || '<i class="fas fa-question-circle" style="color:#888;"></i>';
                iconHtml = `<div class="item-icon-container"><div class="item-icon generic">${faIcon}</div></div>`;
            } else if (item.actionType && ACTION_TYPE_ICONS[item.actionType]) {
                // Action type default (if no custom icon)
                iconHtml = `<div class="item-icon-container"><div class="item-icon generic">${ACTION_TYPE_ICONS[item.actionType]}</div></div>`;
            } else {
                // Image or ultimate fallback
                const img = document.createElement('img');
                img.className = 'item-icon';
                img.alt = item.buttonText || item.headingText;
                img.src = item.icon ? `_Graphics/${item.icon}` : '';
                img.onerror = () => {
                    img.style.display = 'none';
                    const generic = document.createElement('div');
                    generic.className = 'item-icon generic';
                    generic.innerHTML = GENERIC_ICON_SVG;
                    img.parentNode.replaceChild(generic, img);
                };
                iconHtml = `<div class="item-icon-container">${img.outerHTML}</div>`;
            }

            let titleHtml = item.headingText || item.buttonText || 'Unnamed';
            if (item.type === 'checklist_item') {
                titleHtml = (item.completed ? '<span class="checklist-icon">✓</span>' : '<span class="checklist-icon">☐</span>') + titleHtml;
            }

            div.innerHTML = `
                ${iconHtml}
                <div class="item-content">
                    <div class="item-title">${titleHtml}</div>
                    ${item.statusText || item.subText ? `<div class="item-subtext">${item.statusText || item.subText}</div>` : ''}
                </div>
                ${item.favorite ? '<span class="favorite-star">★</span>' : ''}
                ${item.buttonText ? `<button class="item-button ${getButtonClass(item.actionType)}">${item.buttonText}</button>` : ''}
            `;

            div.onclick = () => {
                if (!item.enabled) return;

                if (item.children && item.children.length > 0) {
                    const childLevelId = `${currentLevel}-${item.id}`;
                    let childLevel = document.getElementById(`level-${childLevelId}`);
                    if (!childLevel) {
                        childLevel = createLevel(childLevelId, item.children, currentLevel);
                        document.getElementById('levels-container').appendChild(childLevel);
                    }
                    navStack.push(childLevelId);
                    showLevel(childLevelId);
                } else {
                    const payload = item.fullPath
                        ? `${item.id}|${item.fullPath}`
                        : `Action: ${item.id} - ${item.buttonText || item.headingText}`;
                    webPageActivity(payload);
                }
            };

            return div;
        }

        function showLevel(levelId) {
            document.querySelectorAll('.level').forEach(l => l.classList.add('hidden'));
            document.getElementById(`level-${levelId}`).classList.remove('hidden');

            const pathBar = document.getElementById('path-bar');
            const pathText = navStack.map((id, idx) => {
                const name = id === 'root' ? 'Main Menu' : id.split('-').pop().replace(/_/g, ' ').replace(/\b\w/g, c => c.toUpperCase());
                return idx === navStack.length - 1 ? `<span>${name}</span>` : name;
            }).join(' <span class="node"></span> ');
            pathBar.innerHTML = pathText;
            pathBar.style.display = navStack.length > 1 ? 'block' : 'none';
        }

        function goBack() {
            if (navStack.length > 1) {
                navStack.pop();
                showLevel(navStack[navStack.length - 1]);
            }
        }

        function getButtonClass(type) {
            if (type === 'robot_motion') return 'btn-robot';
            if (type === 'device_control') return 'btn-device';
            if (type === 'action') return 'btn-action';
            return 'btn-nav';
        }

        function webPageActivity(message) {
            console.log('Sent to supervisory app:', message);
            // In WebView2: window.chrome.webview.postMessage(message);
        }

        // Load the sample JSON
        loadMenu(sampleJson);
    </script>
</body>

</html>